#!/usr/bin/env bb

(require '[babashka.pods :as pods])

(pods/load-pod 'org.babashka/go-sqlite3 "0.1.0")
(require '[pod.babashka.go-sqlite3 :as sqlite])

(require '[babashka.fs :as fs])

(def usr-path
  (-> "~/Library/Application Support/Godot/app_userdata/"
      fs/expand-home
      str))

(def db-path "data/trot-dev.db")
; (fs/exists? db-path)

(defn sql [query]
  (sqlite/query db-path [query]))


(defn select-projects [where]
  (sql (str "select * from projects where " where)))


(defn select-projects-all []
  (select-projects "1=1"))

(defn delete-projects [where]
  (sql (str "delete from projects where " where)))

(prn (count (select-projects-all)))

; (delete-projects "created_at > '2025-09-13T13'")


(defn select-hoofprints [where]
  (sql (str "select * from hoofprints where " where)))

(defn select-hoofprints-all []
  (select-hoofprints "1=1"))


(select-hoofprints-all)

(sql "select sum(duration) as duration from hoofprints where project_id=8")

(map #(map % [:project_id :date :duration])
    (sql "select * from hoofprints"))

(sql "select * from projects where id = 11")

(sql "select * from files inner join projects on projects.id = files.project_id")
